{% extends "layout.html" %}
{% block title %}Prediction Result{% endblock %}
{% block content %}

<div class="container py-5">
  <div class="text-center">
    <h2 class="mb-4">Your Health Risk Prediction</h2>

    {% if prediction %}
      <div class="alert alert-info p-4">
        <h4 class="mb-3">Result:</h4>
        <p class="lead">{{ prediction }}</p>
        {% if confidence > 50 %}
          <p>Model confidence: {{ confidence }}%</p>
        {% else %}
          <p>Model is uncertain about the prediction</p>
        {% endif %}
      </div>

      {% if recommendations %}
        <div class="mt-5 text-start mx-auto" style="max-width: 720px;">
          <h4 class="mb-3 text-success">Recommendations:</h4>
          <ul class="list-group">
            {% for rec in recommendations %}
              <li class="list-group-item">{{ rec }}</li>
            {% endfor %}
          </ul>
        </div>

        {% set show_sim = false %}
        {% for rec in recommendations %}
          {% if 'smok' in rec.lower() or 'drink' in rec.lower() %}
            {% set show_sim = true %}
          {% endif %}
        {% endfor %}

        {% if show_sim %}
        <div class="mt-5 text-start mx-auto" style="max-width: 720px;">
          <h4 class="mb-3 text-primary">What-If Simulator 🔮</h4>
          <p class="text-muted">Adjust your habits and see how your risk might change (for fun, not actual medical advice 😅)</p>

          <div class="mb-3">
            <label for="smokingSlider" class="form-label">🚬 Cigarettes per day: <span id="smokeVal">5</span></label>
            <input type="range" class="form-range" id="smokingSlider" min="0" max="20" value="5" oninput="simulateRisk()">
          </div>

          <div class="mb-3">
            <label for="drinkingSlider" class="form-label">🍺 Drinks per week: <span id="drinkVal">3</span></label>
            <input type="range" class="form-range" id="drinkingSlider" min="0" max="14" value="3" oninput="simulateRisk()">
          </div>

          <div class="alert alert-secondary">
            Simulated Risk: <strong id="simRisk">Moderate 🟡</strong>
          </div>
        </div>

        <script>
          function simulateRisk() {
            const smoke = parseInt(document.getElementById("smokingSlider").value);
            const drink = parseInt(document.getElementById("drinkingSlider").value);

            document.getElementById("smokeVal").innerText = smoke;
            document.getElementById("drinkVal").innerText = drink;

            let riskScore = smoke * 2 + drink * 1.5;
            let risk = "Low 🟢";
            if (riskScore > 20) risk = "High 🔴";
            else if (riskScore > 10) risk = "Moderate 🟡";

            document.getElementById("simRisk").innerText = risk;
          }

          window.addEventListener('DOMContentLoaded', simulateRisk);
        </script>
        {% endif %}
      {% endif %}

    {% else %}
      <div class="alert alert-warning">
        No prediction was generated.
      </div>
    {% endif %}

    <a href="{{ url_for('predict') }}" class="btn btn-primary mt-4">Try Another Prediction</a>
  </div>
</div>

{% endblock %}
